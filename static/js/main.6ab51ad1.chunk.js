(this["webpackJsonpreact-rps"]=this["webpackJsonpreact-rps"]||[]).push([[0],{26:function(e,t,a){e.exports=a(43)},31:function(e,t,a){},43:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(23),o=a.n(c),l=(a(31),a(4)),s=a(10),i=a(2);var u=function(e){var t=e.title,a=e.games;return Object.keys(a).length?r.a.createElement(r.a.Fragment,null,r.a.createElement("hr",null),r.a.createElement("h5",{className:"card-title"},t),r.a.createElement("div",{className:"btn-group-vertical d-block"},Object.keys(a).map((function(e){return r.a.createElement(l.b,{className:"btn btn-primary",to:"/game/".concat(e),key:e},e)})))):null},m=a(9),d=a.n(m),p=a(12),f=a(6);a(37);f.initializeApp({apiKey:"AIzaSyCpU5AfFhgbrjaTR8sKyB_O6h9VYGCNmDk",authDomain:"rock-paper-scissors-b198e.firebaseapp.com",databaseURL:"https://rock-paper-scissors-b198e.firebaseio.com",projectId:"rock-paper-scissors-b198e",storageBucket:"rock-paper-scissors-b198e.appspot.com",messagingSenderId:"530589049037",appId:"1:530589049037:web:f677fbd6b66d8483654984"});var h=f.firestore(),b=function(e){return h.collection("games").doc(e)},E=function(e,t){var a={userId:t,weapon:null};(e instanceof f.firestore.DocumentReference?e:b(e)).collection("players").add(a).catch((function(e){return console.log("Error encountered: ".concat(e))}))},g=function(){var e=Object(p.a)(d.a.mark((function e(t,a,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={weapon:n},e.abrupt("return",t.collection("players").where("userId","==",a).get().then((function(e){return e.docs[0].ref.update(r)})));case 2:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),v=function(){var e=Object(p.a)(d.a.mark((function e(t,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.collection("players").where("userId","==",a).get().then((function(e){return e.empty?E(t,a).then((function(){return null})):e.docs[0].data().weapon})));case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),w=function(e){var t={tie:!1,userId:null,weapon:null};if(e.length<2||e.some((function(e){return null===e.weapon})))return t;var a=Object(i.a)(e,2),n=a[0],r=a[1];return"Rock"===n.weapon&&"Scissors"===r.weapon||"Paper"===n.weapon&&"Rock"===r.weapon||"Scissors"===n.weapon&&"Paper"===r.weapon?Object.assign(t,n):n.weapon===r.weapon?(t.tie=!0,t.weapon=n.weapon):Object.assign(t,r),t},N=function(e){return e.collection("players").get().then((function(e){e.docs.forEach((function(e){return e.ref.update({weapon:null})}))}))},y=function(e){return h.collectionGroup("players").where("userId","==",e).get().then((function(e){return e.docs.map((function(e){return e.ref.parent.parent}))}))},O=(a(41),function(){var e={};try{e=JSON.parse(window.localStorage.getItem("player"))||{}}catch(t){console.log("Deleting corrupted player in local storage."),window.localStorage.removeItem("player")}return e}),j=function(e){return window.localStorage.setItem("player",JSON.stringify(e))},I=function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.collection("users"),e.abrupt("return",a.where("email","==",t.email).get().then((function(e){if(e.empty)return a.add(t).then((function(e){return t.id=e.id,t}));var n=e.docs[0].ref;return n.update(t).then((function(){return t.id=n.id,t}))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(p.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.collection("users").doc(t).get().then((function(e){return e.data()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=new f.auth.GoogleAuthProvider;f.auth().signInWithRedirect(e)},x=function(e){var t={url:"production"===Object({NODE_ENV:"production",PUBLIC_URL:"/react-rps"}).ENVIRONMENT?"https://iamkevinlowe.github.io/react-rps":"http://localhost:3000",handleCodeInApp:!0};f.auth().sendSignInLinkToEmail(e.email,t).then((function(){return window.localStorage.setItem("userForSignInEmail",JSON.stringify(e))}))},F=function(){if(f.auth().isSignInWithEmailLink(window.location.href)){var e=null;try{e=JSON.parse(window.localStorage.getItem("userForSignInEmail"))}catch(t){console.log("User corrupted in local storage"),window.localStorage.removeItem("userForSignInEmail")}if(!e)throw new Error("No cached user");return f.auth().signInWithEmailLink(e.email,window.location.href).then((function(t){var a=t.user;return window.localStorage.removeItem("userForSignInEmail"),a?I({email:a.email||e.email,uid:a.uid,name:e.name||a.displayName}):null}))}return f.auth().getRedirectResult().then((function(e){var t=e.user;return t?I({email:t.email,uid:t.uid,name:t.displayName}):null}))};var P=function(){var e=O().id,t=Object(n.useState)({}),a=Object(i.a)(t,2),c=a[0],o=a[1],l=Object(n.useState)({}),m=Object(i.a)(l,2),d=m[0],p=m[1],f=Object(n.useState)({}),h=Object(i.a)(f,2),b=h[0],E=h[1],g=Object(n.useState)({wins:0,ties:0,losses:0}),v=Object(i.a)(g,2),N=v[0],j=v[1];Object(n.useEffect)((function(){e&&y(e).then((function(e){var t=e.map((function(e){return e.collection("players").get()}));Promise.all(t).then(I)}))}),[e]);var I=function(t){var a=Object.assign({},c),n=Object.assign({},d),r=Object.assign({},b),l=Object.assign({},N);t.forEach((function(t){var c=t.docs[0].ref.parent.parent;if(t.size<2)a[c.id]=c;else{a.hasOwnProperty(c.id)&&delete a[c.id];var o=t.docs.map((function(e){return e.data()})),s=w(o);if(null===s.userId&&!1===s.tie)o.find((function(t){return t.userId===e})).weapon?n[c.id]=c:r[c.id]=c;else n.hasOwnProperty(c.id)?delete n[c.id]:r.hasOwnProperty(c.id)&&delete r[c.id],s.userId===e?l.wins++:s.tie?l.ties++:null!==s.userId&&l.losses++}})),o(a),p(n),E(r),j(l)};return e?r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-8 offset-sm-2"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header"},"Dashboard"),r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title"},"Your Stats"),r.a.createElement("p",{className:"card-text"},r.a.createElement("span",{className:"strong"},"Wins:")," ",N.wins),r.a.createElement("p",{className:"card-text"},r.a.createElement("span",{className:"strong"},"Ties:")," ",N.ties),r.a.createElement("p",{className:"card-text"},r.a.createElement("span",{className:"strong"},"Losses:")," ",N.losses),r.a.createElement(u,{title:"Waiting for an opponent...",games:c}),r.a.createElement(u,{title:"Waiting for opponent's move...",games:d}),r.a.createElement(u,{title:"Waiting for your move...",games:b}))))):r.a.createElement(s.a,{to:"/home?redirectTo=/dashboard"})},R=function(e,t){if(!(e instanceof Object&&t instanceof Object))return!1;var a=Object.keys(e);if(a.length!==Object.keys(t).length)return!1;for(var n=0;n<a.length;n++){var r=a[n];if(e[r]!==t[r])return!1}return!0},C=function e(t,a){if(!(t instanceof Array&&a instanceof Array)||t.length!==a.length)return!1;for(var n=t.slice(0).sort(),r=a.slice(0).sort(),c=0;c<n.length;c++){var o=n[c],l=r[c];if(!(o instanceof Object&&R(o,l)||o instanceof Array&&e(o,l)||o===l))return!1}return!0};var D=function(e){var t=e.gameDocument,a=e.players,c=e.userId,o=Object(n.useState)(null),s=Object(i.a)(o,2),u=s[0],m=s[1],d=Object(n.useState)({}),p=Object(i.a)(d,2),f=p[0],h=p[1];Object(n.useEffect)((function(){v(t,c).then((function(e){return m(e)}))}),[t,c]),Object(n.useEffect)((function(){var e=w(a);R(e,f)||h(e)}),[a]);var b=function(){return a.map((function(e){return e.name})).join(" vs. ")},E=function(e){var t="";switch(e){case"Rock":t="fas fa-hand-rock";break;case"Paper":t="fas fa-hand-paper";break;case"Scissors":t="fas fa-hand-scissors";break;default:return null}return r.a.createElement("i",{className:t})},y=function(e){var a=e.currentTarget.dataset.name;g(t,c,a).then((function(){return m(a)}))};return f.tie?(setTimeout((function(){N(t),m(null),h({})}),3e3),r.a.createElement(r.a.Fragment,null,r.a.createElement("h5",{className:"card-title"},b()),r.a.createElement("p",{className:"card-text"},"It was a tie! Both selected ",r.a.createElement("span",{className:"text-primary"},E(f.weapon)),". Starting a new match..."))):f.userId?r.a.createElement(r.a.Fragment,null,r.a.createElement("h5",{className:"card-title"},f.userId===c?["Congrats, you beat ".concat(a.find((function(e){return e.userId!==f.userId})).name," with "),r.a.createElement("span",{className:"text-primary",key:u},E(u)),"!"]:["Sorry, ".concat(f.name," won with "),r.a.createElement("span",{className:"text-primary",key:u},E(f.weapon)),"."]),r.a.createElement(l.b,{to:"/home",className:"btn btn-primary btn-block"},"Play again?")):r.a.createElement(r.a.Fragment,null,r.a.createElement("h5",{className:"card-title"},b()),u?r.a.createElement("p",{className:"card-text"},"You chose ",r.a.createElement("span",{className:"text-primary"},E(u)),"!",r.a.createElement("br",null),"Waiting for your opponent..."):r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"card-text"},"Choose your weapon!"),r.a.createElement("div",{className:"btn-group d-flex"},["Rock","Paper","Scissors"].map((function(e){return r.a.createElement("button",{type:"button",className:"btn btn-outline-primary",style:{flexGrow:1},"data-name":e,onClick:y,key:e},E(e))})))))};var W=function(){var e=Object(s.h)().gameId,t=O().id,a=b(e),c=Object(n.useState)([]),o=Object(i.a)(c,2),l=o[0],u=o[1],m=Object(n.useState)(null),d=Object(i.a)(m,2),p=d[0],f=d[1];return Object(n.useEffect)((function(){return a.collection("players").onSnapshot((function(e){var n=e.docs.map((function(e){var t=e.data(),a=t.userId,n=t.weapon;return S(a).then((function(e){return e.userId=a,e.weapon=n,e}))}));Promise.all(n).then((function(e){e.find((function(e){return e.userId===t}))||(e.length>=2?f("/home"):t?E(a,t):f("/home?redirectTo=".concat(window.location.hash.slice(1)))),C(e,l)||u(e)}))}))}),[]),p?r.a.createElement(s.a,{to:p}):r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-8 offset-sm-2"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header"},e),r.a.createElement("div",{className:"card-body"},l.length<2?r.a.createElement("h5",{className:"card-title"},"Waiting for player..."):r.a.createElement(D,{gameDocument:a,players:l,userId:t})))))};var L=function(e){e.userId;var t=Object(n.useState)(null),a=Object(i.a)(t,2),c=a[0],o=a[1];return c?r.a.createElement(s.a,{to:"/game/".concat(c)}):r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("p",{className:"card-text"},"Decide if you want to start a new game, or join an existing one"),r.a.createElement("button",{className:"btn btn-primary btn-block mb-3",onClick:function(){var e="Game_".concat(Math.round(1e3*Math.random()));o(e)}},"Start a new game"),r.a.createElement("hr",null),r.a.createElement("form",{className:"form-inline",onSubmit:function(e){e.preventDefault();var t=e.target.elements.name.value.trim();o(t)}},r.a.createElement("div",{className:"input-group w-100"},r.a.createElement("input",{type:"text",className:"form-control",name:"name",placeholder:"Game Name"}),r.a.createElement("div",{className:"input-group-append"},r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Join a game"))))))};var T=function(){var e=Object(n.useState)(!1),t=Object(i.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(!1),l=Object(i.a)(o,2),s=l[0],u=l[1];return Object(n.useEffect)((function(){window.localStorage.hasOwnProperty("userForSignInEmail")&&c(!0)}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("hr",null),a?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"card-text"},s?"Verification email sent...":"Waiting for email verification..."),r.a.createElement("button",{className:"btn btn-link",onClick:function(e){var t=null;try{t=JSON.parse(window.localStorage.getItem("userForSignInEmail"))}catch(a){console.log("User corrupted in local storage"),window.localStorage.removeItem("userForSignInEmail")}t?(x(t),u(!0),setTimeout((function(){u(!1)}),3e3)):c(!1)}},"Click here to resend verification email")):r.a.createElement("form",{onSubmit:function(e){e.preventDefault();var t=e.target.elements.name.value.trim(),a=e.target.elements.email.value.trim().toLowerCase();t&&a&&x({name:t,email:a})}},r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",className:"form-control",name:"name",placeholder:"Your Name"})),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"email",className:"form-control",name:"email",placeholder:"Your Email"})),r.a.createElement("button",{type:"submit",className:"btn btn-primary btn-block"},"Let's RPS!")))};var U=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("hr",null),r.a.createElement("button",{className:"btn btn-block btn-outline-secondary",onClick:function(e){k()}},r.a.createElement("span",{className:"badge badge-light mr-2"},r.a.createElement("i",{className:"fa fa-google"})),"Sign in with Google"))};var A=function(e){var t=e.setUser;return Object(n.useEffect)((function(){F().then((function(e){return e&&t(e)}))}),[t]),r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title"},"New phone, who dis?"),r.a.createElement("p",{className:"card-text"},"Before we begin, I need to know who you are"),r.a.createElement(T,null),r.a.createElement(U,null)))};var J=function(){var e=Object(n.useState)(O()),t=Object(i.a)(e,2),a=t[0],c=t[1],o=new URLSearchParams(Object(s.g)().search).get("redirectTo");return a.id&&o?r.a.createElement(s.a,{to:o}):r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-8 offset-sm-2"},a.id?r.a.createElement(L,{userId:a.id}):r.a.createElement(A,{setUser:function(e){j(e),c(e)}})))};var B=function(){var e=Object(s.i)({path:"/dashboard",strict:!0}),t=Object(s.i)({path:"/home",strict:!0});return r.a.createElement("ul",{className:"nav nav-pills mt-3 mb-5"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(l.b,{className:"nav-link".concat(t?" active":""),to:"/home"},"Home")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(l.b,{className:"nav-link".concat(e?" active":""),to:"/dashboard"},"Dashboard")))};var G=function(){return r.a.createElement(l.a,null,r.a.createElement(B,null),r.a.createElement(s.d,null,r.a.createElement(s.a,{exact:!0,from:"/",to:"/home"}),r.a.createElement(s.b,{path:"/game/:gameId"},r.a.createElement(W,null)),r.a.createElement(s.b,{path:"/dashboard"},r.a.createElement(P,null)),r.a.createElement(s.b,{path:"/home"},r.a.createElement(J,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(G,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[26,1,2]]]);
//# sourceMappingURL=main.6ab51ad1.chunk.js.map